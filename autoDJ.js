webpackJsonp([1],{0:function(e,t,n){n(346),e.exports=n(469)},51:function(e,t){"use strict";e.exports={UPLOAD_TRACK:"track.upload",NEXT_TRACK:"tack.next",PLAY:"track.play",PAUSE:"track.pause",TRACK_PLAYING:"track.playing"}},73:function(e,t,n){"use strict";var r=n(5),a=r.createClass({displayName:"Row",render:function(){return r.createElement("div",{className:"row"},this.props.children)}});e.exports=a},74:function(e,t,n){"use strict";var r=n(86),a=n(333),s=n(347),i={playlist:new s},c=new r.Flux(i,a);e.exports=c},100:function(e,t,n){"use strict";var r=n(5),a=r.createClass({displayName:"Column",propTypes:{s:r.PropTypes.number.isRequired,m:r.PropTypes.number,l:r.PropTypes.number},generateClassName:function(){var e="col-xs-"+this.props.s;return this.props.m&&(e=e+" col-md-"+this.props.m),this.props.l&&(e=e+" col-lg-"+this.props.l),e},render:function(){return r.createElement("div",{className:this.generateClassName()},this.props.children)}});e.exports=a},140:function(e,t,n){"use strict";var r=n(5),a=r.createClass({displayName:"FluidContainer",render:function(){return r.createElement("div",{className:"container-fluid"},this.props.children)}});e.exports=a},141:function(e,t,n){"use strict";var r=n(5),a=r.createClass({displayName:"Gliff",propTypes:{gliff:r.PropTypes.string.isRequired},render:function(){return r.createElement("span",{className:"glyphicon glyphicon-"+this.props.gliff,"aria-hidden":"true"})}});e.exports=a},142:function(e,t,n){"use strict";var r=n(5),a=n(73),s=n(100),i=r.createClass({displayName:"Track",propertTypes:{Track:r.PropTypes.object.isRequired},render:function(){return r.createElement("div",{className:"track"},r.createElement(a,null,r.createElement(s,{s:6},this.props.track.name),r.createElement(s,{s:6},this.props.track.bpm)),r.createElement(a,null,r.createElement(s,{s:12},this.renderTrackAnalysis())))},renderTrackAnalysis:function(){return this.props.track.analysed?this.renderAnalysis():this.renderAwaitingAnalysis()},renderAnalysis:function(){return r.createElement("svg",{className:"track-analysis"},this.props.track.peaks.reduce(this.grabEveryFourthPeak,[]).map(this.createSomeRectangles))},renderAwaitingAnalysis:function(){return r.createElement("div",{className:"awaiting-analysis"},r.createElement("span",null,"Awaiting Analysis"))},grabEveryFourthPeak:function(e,t,n){return n%4===0&&e.push(t),e},createSomeRectangles:function(e){var t=this.props.track.bufferLength,n=100*e/t+"%";return r.createElement("rect",{key:n,x:n,y:"0",width:"1",height:"100%"})}});e.exports=i},143:function(e,t,n){"use strict";var r=n(86),a=n(297);e.exports={storeWatch:r.StoreWatchMixin,LinkedStateMixin:a}},144:function(e,t){"use strict";e.exports={PLAY_LIST:"playlist"}},333:function(e,t,n){"use strict";e.exports={uploadTrack:n(338),nextTrack:n(334),play:n(336),pause:n(335),trackPlaying:n(337)}},334:function(e,t,n){"use strict";var r=n(51),a=function(){this.dispatch(r.NEXT_TRACK)};e.exports=a},335:function(e,t,n){"use strict";var r=n(51),a=function(){this.dispatch(r.PAUSE)};e.exports=a},336:function(e,t,n){"use strict";var r=n(51),a=function(){this.dispatch(r.PLAY)};e.exports=a},337:function(e,t,n){"use strict";var r=n(51),a=function(e,t,n){this.dispatch(r.TRACK_PLAYING,{source:e,gain:t,trackLoaded:n})};e.exports=a},338:function(e,t,n){"use strict";var r=n(51),a=function(e){this.dispatch(r.UPLOAD_TRACK,e)};e.exports=a},339:function(e,t,n){"use strict";var r=n(5),a=n(141),s=r.createClass({displayName:"SaveButton",propTypes:{click:r.PropTypes.func.isRequired,gliff:r.PropTypes.string.isRequired},render:function(){return r.createElement("button",{type:"button",onClick:this.props.click,className:"btn btn-primary btn-block"},r.createElement(a,{gliff:this.props.gliff}))}});e.exports=s},340:function(e,t,n){"use strict";var r=n(5),a=n(344),s=r.createClass({displayName:"Layout",render:function(){return r.createElement("div",null,r.createElement(a,null),this.props.children)}});e.exports=s},341:function(e,t,n){"use strict";var r=n(5),a=n(100),s=n(73),i=n(140),c=n(142),o=n(339),l=n(74),u=n(143),p=n(144),f=3,m=70,d=new AudioContext,h=r.createClass({displayName:"Player",mixins:[u.storeWatch(p.PLAY_LIST)],getDefaultProps:function(){return{flux:l}},getStateFromFlux:function(){return l.store(p.PLAY_LIST).getState()},play:function(){var e=this.state.trackLoaded;e?this.resume():this.enqueueTrack()},enqueueTrack:function(){var e=l.store(p.PLAY_LIST).getState().tracks,t=e[0],n=this;Promise.resolve().then(function(){return console.log("starting playing"),l.actions.play()}).then(function(){return n.prepTrack(t)}).then(function(e){var t=e.source,r=e.gain;return n.fadeIn(t,r)}).then(function(e){var t=e.source,r=e.gain;return n.savePlayingTrack(t,r)})},pause:function(){d.suspend(),l.actions.pause()},resume:function(){d.resume(),l.actions.play()},savePlayingTrack:function(e,t){return new Promise(function(n){console.debug("save playing track"),l.actions.trackPlaying(e,t,!0),console.debug("now playing"),n()})},prepTrack:function(e){return console.debug("preparing track",e),new Promise(function(t){d.decodeAudioData(e.arrayBuffer,function(n){var r=d.createBufferSource(),a=d.createGain();r.buffer=n,r.connect(a),a.connect(d.destination),console.log("track prepared",e),t({source:r,gain:a})})})},fadeIn:function(e,t){return new Promise(function(n){console.debug("fading in");var r=d.currentTime;t.gain.exponentialRampToValueAtTime(.1,r),t.gain.exponentialRampToValueAtTime(1,r+f),e.start(0,m),setTimeout(function(){console.debug("faded track in"),n({source:e,gain:t})},1e3*f)})},fadeOut:function(e,t){var n=d.currentTime;return console.debug("fading out"),new Promise(function(r){t.gain.exponentialRampToValueAtTime(1,n),t.gain.exponentialRampToValueAtTime(.1,n+f),setTimeout(function(){console.debug("faded out"),e.stop(),r()},1e3*f)})},skip:function(){var e=this,t=l.store(p.PLAY_LIST).getState(),n=t.tracks,r=n[1],a=void 0,s=void 0;Promise.resolve().then(function(){return e.prepTrack(r)}).then(function(t){var n=t.source,r=t.gain;return a=n,s=r,e.fadeIn(n,r)}).then(function(){return e.fadeOut(t.source,t.gain)}).then(function(){return e.savePlayingTrack(a,s)}).then(function(){console.log("next Track"),l.actions.nextTrack()})},render:function(){var e=l.store(p.PLAY_LIST).getState().tracks,t=e[0],n=e[1];return r.createElement(i,null,r.createElement(s,null,this.renderTrack(t)),r.createElement(s,null,this.renderTrack(n)),r.createElement("hr",null),r.createElement(s,null,r.createElement(a,{s:6},this.renderPlayOrPause()),r.createElement(a,{s:6},r.createElement(o,{gliff:"forward",click:this.skip}))))},renderTrack:function(e){return e?r.createElement(c,{track:e}):r.createElement("div",null,r.createElement("p",null,"Queue Some Tracks!"))},renderPlayOrPause:function(){return this.state.playing?r.createElement(o,{gliff:"pause",click:this.pause}):r.createElement(o,{gliff:"play",click:this.play})}});e.exports=h},342:function(e,t,n){"use strict";var r=n(5),a=n(74),s=n(298),i=n(140),c=n(73),o=n(343),l=r.createClass({displayName:"Playlist",onDrop:function(e){console.log(e),a.actions.uploadTrack(e[0])},render:function(){return r.createElement("div",{className:"playlist"},r.createElement(i,null,r.createElement(c,null,r.createElement(s,{className:"upload",onDrop:this.onDrop,multiple:!1},r.createElement("span",{className:"upload-txt"},"Drop Tracks here, or click to select tracks from your file system"))),r.createElement(c,null,r.createElement(o,null))))}});e.exports=l},343:function(e,t,n){"use strict";var r=n(5),a=n(74),s=n(143),i=n(144),c=n(73),o=n(100),l=n(142),u=r.createClass({displayName:"Tracks",mixins:[s.storeWatch(i.PLAY_LIST)],getDefaultProps:function(){return{flux:a}},getStateFromFlux:function(){return a.store(i.PLAY_LIST).getState()},render:function(){return r.createElement("div",{className:"tracks"},r.createElement(c,null,r.createElement(o,{s:12},r.createElement("ol",null,this.state.tracks.map(this.renderTrack)))))},renderTrack:function(e){return r.createElement("li",{key:e.id},r.createElement(l,{track:e}))}});e.exports=u},344:function(e,t,n){"use strict";var r=n(5),a=n(119).Link,s=n(141),i=r.createClass({displayName:"NavBarContainer",render:function(){return r.createElement("nav",{className:"navbar navbar-default navbar-fixed-top"},r.createElement("div",{className:"container-fluid"},r.createElement("div",{className:"navbar-header"},r.createElement("button",{type:"button",className:"navbar-toggle collapsed","data-toggle":"collapse","data-target":"#navbar","aria-expanded":"false","aria-controls":"navbar"},r.createElement("span",{className:"sr-only"},"Toggle navigation"),r.createElement("span",{className:"icon-bar"}),r.createElement("span",{className:"icon-bar"}),r.createElement("span",{className:"icon-bar"})),r.createElement(a,{to:"/"},r.createElement("h3",null,r.createElement(s,{gliff:"cd"})," Auto DJ"))),r.createElement("div",{id:"navbar",className:"navbar-collapse collapse"},r.createElement("ul",{className:"nav navbar-nav"},r.createElement("li",null,r.createElement(a,{to:"/playlist"},r.createElement(s,{gliff:"list"}),"  Play List")),r.createElement("li",null,r.createElement(a,{to:"/player"},r.createElement(s,{gliff:"equalizer"}),"  Playing"))))))}});e.exports=i},345:function(e,t,n){"use strict";var r=n(184).createHistory();e.exports=r},346:function(e,t,n){"use strict";n(74);var r=n(5),a=n(119),s=a.Router,i=a.Route,c=a.IndexRoute,o=n(117),l=n(340),u=n(341),p=n(342),f=n(345);o.render(r.createElement(s,{history:f},r.createElement(i,{path:"/(autodj)",component:l},r.createElement(i,{path:"player",component:u}),r.createElement(c,{component:p}),r.createElement(i,{path:"playlist",components:p}))),document.getElementById("app"))},347:function(e,t,n){"use strict";var r=n(86),a=n(331),s=n(296),i=n(51),c=n(348),o=r.createStore({initialize:function(){this.state={tracks:[],playing:!1,trackLoaded:!1},this.bindActions(i.UPLOAD_TRACK,this.dealWithUploadedTrack,i.NEXT_TRACK,this.nextTrack,i.PLAY,this.play,i.PAUSE,this.pause,i.TRACK_PLAYING,this.trackPlaying)},getState:function(){return this.state},nextTrack:function(){this.state.tracks=s.drop(1,this.state.tracks),this.emit("change")},play:function(){this.state.playing=!0,this.state.trackLoaded=!0,this.emit("change")},pause:function(){this.state.playing=!1,this.emit("change")},trackPlaying:function(e){var t=e.source,n=e.gain,r=e.trackLoaded;this.state.source=t,this.state.gain=n,this.state.trackLoaded=r,this.emit("change")},dealWithUploadedTrack:function(e){var t=this,n={id:a.v1(),name:e.name,type:e.type,analysed:!1,track:e},r=this,s=new FileReader;Promise.resolve().then(function(){return new Promise(function(e){console.log("adding track"),t.state.tracks.push(n),t.emit("change"),e()})}).then(function(){return new Promise(function(t,n){console.log("reading uploaded file"),s.onload=function(e){console.log("loaded file"),t(e)},s.onerror=function(e){console.log("failed to load file"),n(e)},s.readAsArrayBuffer(e)})}).then(function(e){return new Promise(function(t){console.log("crunching bpm",e);var r=window.OfflineAudioContext||window.webkitOfflineAudioContext,a=new r(1,2,44100);n.arrayBuffer=e.target.result,a.decodeAudioData(e.target.result,function(e){var r=a.createBufferSource();r.buffer=e;var s=a.createBiquadFilter();s.type="lowpass",r.connect(s),s.connect(a.destination),r.start(0);var i,o=.9,l=o,u=.3,p=30;do i=c.getPeaksAtThreshold(e.getChannelData(0),l),l-=.05;while(i.length<p&&l>=u);var f=c.countIntervalsBetweenNearbyPeaks(i),m=c.groupNeighborsByTempo(f,e.sampleRate),d=m.sort(function(e,t){return t.count-e.count}).splice(0,5);n.peaks=i,n.analysed=!0,n.bpm=d[0].tempo,n.bufferLength=e.length,t()})})})["catch"](function(e){return console.error("failed to bpm match the file",e)}).then(function(){console.log("done analysis"),r.emit("change")})}});e.exports=o},348:function(e,t){"use strict";var n=function(e,t){for(var n=[],r=e.length,a=0;r>a;)e[a]>t&&(n.push(a),a+=1e4),a++;return n},r=function(e){var t=[];return e.forEach(function(n,r){for(var a=0;10>a;a++){var s=e[r+a]-n,i=t.some(function(e){return e.interval===s?e.count++:void 0});i||t.push({interval:s,count:1})}}),t},a=function(e,t){var n=[];return e.forEach(function(e){if(0!==e.interval){for(var r=60/(e.interval/t);90>r;)r*=2;for(;r>180;)r/=2;r=Math.round(r);var a=n.some(function(t){return t.tempo===r?(t.count+=e.count,t.count):void 0});a||n.push({tempo:r,count:e.count})}}),n};e.exports={getPeaksAtThreshold:n,countIntervalsBetweenNearbyPeaks:r,groupNeighborsByTempo:a}},469:function(e,t){}});
//# sourceMappingURL=autoDJ.js.map